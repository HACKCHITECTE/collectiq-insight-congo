<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Congo Business Directory - Tableau de Bord</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            slate: {
              850: '#1a2332',
              900: '#0f172a',
              950: '#0a1120'
            },
            congo: {
              green: '#228B22',
              greenDark: '#1a6b1a',
              greenLight: '#2da32d'
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #1e293b; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
    .department-item:hover { background: linear-gradient(90deg, rgba(34, 139, 34, 0.1) 0%, transparent 100%); }
    .department-item.active { background: linear-gradient(90deg, rgba(34, 139, 34, 0.2) 0%, transparent 100%); border-left-color: #228B22; }
  </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen">
  
  <!-- Mobile Menu Overlay -->
  <div id="mobileOverlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

  <div class="flex min-h-screen">
    
    <!-- Sidebar -->
    <aside id="sidebar" class="fixed lg:static inset-y-0 left-0 z-50 w-72 bg-slate-900 border-r border-slate-800 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col">
      
      <!-- Logo -->
      <div class="p-6 border-b border-slate-800">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-br from-congo-green to-congo-greenDark rounded-lg flex items-center justify-center">
            <i class="fas fa-building text-white"></i>
          </div>
          <div>
            <h1 class="font-bold text-white text-lg">Congo Directory</h1>
            <p class="text-xs text-slate-400">Business Registry</p>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="p-4">
        <ul class="space-y-1">
          <li>
            <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-slate-800/50 text-congo-green border-l-2 border-congo-green">
              <i class="fas fa-chart-line w-5"></i>
              <span class="font-medium">Tableau de Bord</span>
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-slate-800/30 transition-colors border-l-2 border-transparent">
              <i class="fas fa-list w-5"></i>
              <span>Annuaire complet</span>
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-slate-800/30 transition-colors border-l-2 border-transparent">
              <i class="fas fa-chart-pie w-5"></i>
              <span>Statistiques par Département</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Departments Filter -->
      <div class="flex-1 overflow-hidden flex flex-col px-4 pb-4">
        <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3 px-4">Départements</h3>
        <div class="flex-1 overflow-y-auto scrollbar-thin">
          <ul id="departmentList" class="space-y-1">
            <!-- Departments will be populated by JS -->
          </ul>
        </div>
      </div>

      <!-- Footer -->
      <div class="p-4 border-t border-slate-800">
        <p class="text-xs text-slate-500 text-center">© 2025 Congo Business Directory</p>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0">
      
      <!-- Top Header -->
      <header class="bg-slate-900/80 backdrop-blur-sm border-b border-slate-800 px-4 lg:px-8 py-4 sticky top-0 z-30">
        <div class="flex items-center gap-4">
          
          <!-- Mobile Menu Button -->
          <button onclick="toggleSidebar()" class="lg:hidden p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors">
            <i class="fas fa-bars text-xl"></i>
          </button>

          <!-- Search Bar -->
          <div class="flex-1 max-w-2xl">
            <div class="relative">
              <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
              <input 
                type="text" 
                id="searchInput"
                placeholder="Rechercher par nom ou numéro d'immatriculation..." 
                class="w-full bg-slate-800/50 border border-slate-700 rounded-xl pl-12 pr-4 py-3 text-sm placeholder-slate-500 focus:outline-none focus:border-congo-green focus:ring-1 focus:ring-congo-green/50 transition-all"
              >
            </div>
          </div>

          <!-- Profile -->
          <div class="flex items-center gap-3">
            <button class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors relative">
              <i class="fas fa-bell"></i>
              <span class="absolute top-1 right-1 w-2 h-2 bg-congo-green rounded-full"></span>
            </button>
            <div class="hidden sm:flex items-center gap-3 pl-3 border-l border-slate-700">
              <div class="w-9 h-9 bg-gradient-to-br from-congo-green to-congo-greenDark rounded-full flex items-center justify-center text-white font-semibold text-sm">
                AD
              </div>
              <div class="hidden md:block">
                <p class="text-sm font-medium text-white">Admin</p>
                <p class="text-xs text-slate-400">Gestionnaire</p>
              </div>
              <i class="fas fa-chevron-down text-slate-400 text-xs"></i>
            </div>
          </div>
        </div>
      </header>

      <!-- Dashboard Content -->
      <div class="flex-1 p-4 lg:p-8 overflow-y-auto">
        
        <!-- Analytics Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6 mb-8">
          
          <!-- Total Companies -->
          <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-6 border border-slate-700/50 hover:border-slate-600 transition-colors">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-slate-400 text-sm font-medium mb-1">Total Entreprises</p>
                <p id="totalCompanies" class="text-3xl font-bold text-white">0</p>
                <p class="text-xs text-congo-green mt-2 flex items-center gap-1">
                  <i class="fas fa-arrow-up"></i>
                  <span>+12% ce mois</span>
                </p>
              </div>
              <div class="w-12 h-12 bg-congo-green/10 rounded-xl flex items-center justify-center">
                <i class="fas fa-building text-congo-green text-xl"></i>
              </div>
            </div>
          </div>

          <!-- Companies This Year -->
          <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-6 border border-slate-700/50 hover:border-slate-600 transition-colors">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-slate-400 text-sm font-medium mb-1">Créées cette année</p>
                <p id="companiesThisYear" class="text-3xl font-bold text-white">0</p>
                <p class="text-xs text-blue-400 mt-2 flex items-center gap-1">
                  <i class="fas fa-calendar"></i>
                  <span>Année 2025</span>
                </p>
              </div>
              <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center">
                <i class="fas fa-plus-circle text-blue-400 text-xl"></i>
              </div>
            </div>
          </div>

          <!-- Most Active Department -->
          <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-6 border border-slate-700/50 hover:border-slate-600 transition-colors sm:col-span-2 lg:col-span-1">
            <div class="flex items-start justify-between">
              <div>
                <p class="text-slate-400 text-sm font-medium mb-1">Département le plus actif</p>
                <p id="mostActiveDept" class="text-2xl font-bold text-white">-</p>
                <p id="mostActiveDeptCount" class="text-xs text-amber-400 mt-2 flex items-center gap-1">
                  <i class="fas fa-trophy"></i>
                  <span>0 entreprises</span>
                </p>
              </div>
              <div class="w-12 h-12 bg-amber-500/10 rounded-xl flex items-center justify-center">
                <i class="fas fa-map-marker-alt text-amber-400 text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
          
          <!-- Bar Chart -->
          <div class="bg-slate-900 rounded-2xl p-6 border border-slate-800">
            <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
              <i class="fas fa-chart-bar text-congo-green"></i>
              Répartition par Département
            </h3>
            <div class="h-72">
              <canvas id="departmentChart"></canvas>
            </div>
          </div>

          <!-- Pie Chart -->
          <div class="bg-slate-900 rounded-2xl p-6 border border-slate-800">
            <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
              <i class="fas fa-chart-pie text-congo-green"></i>
              Répartition par Année de Création
            </h3>
            <div class="h-72 flex items-center justify-center">
              <canvas id="yearChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Data Table -->
        <div class="bg-slate-900 rounded-2xl border border-slate-800 overflow-hidden">
          <div class="p-6 border-b border-slate-800 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <h3 class="text-lg font-semibold text-white flex items-center gap-2">
              <i class="fas fa-table text-congo-green"></i>
              Liste des Entreprises
            </h3>
            <div class="flex items-center gap-2 text-sm text-slate-400">
              <span>Affichage:</span>
              <span id="displayCount" class="text-white font-medium">0</span>
              <span>entreprises</span>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-800/50">
                <tr>
                  <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">N° Immatriculation</th>
                  <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Nom de l'Entreprise</th>
                  <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden md:table-cell">Date de Création</th>
                  <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider hidden lg:table-cell">Fondateur</th>
                  <th class="text-left px-6 py-4 text-xs font-semibold text-slate-400 uppercase tracking-wider">Département</th>
                </tr>
              </thead>
              <tbody id="companyTableBody" class="divide-y divide-slate-800">
                <!-- Table rows will be populated by JS -->
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div id="emptyState" class="hidden p-12 text-center">
            <i class="fas fa-search text-4xl text-slate-600 mb-4"></i>
            <p class="text-slate-400">Aucune entreprise trouvée</p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeModal()"></div>
    <div class="absolute inset-4 sm:inset-auto sm:top-1/2 sm:left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 sm:w-full sm:max-w-lg bg-slate-900 rounded-2xl border border-slate-700 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
      
      <!-- Modal Header -->
      <div class="bg-gradient-to-r from-congo-green to-congo-greenDark p-6">
        <div class="flex items-start justify-between">
          <div>
            <p class="text-congo-green/70 text-xs font-medium uppercase tracking-wider mb-1">Détails de l'entreprise</p>
            <h2 id="modalCompanyName" class="text-xl font-bold text-white">-</h2>
          </div>
          <button onclick="closeModal()" class="w-8 h-8 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition-colors">
            <i class="fas fa-times text-white"></i>
          </button>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="p-6 overflow-y-auto">
        <div class="space-y-4">
          
          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-hashtag text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Numéro d'Immatriculation</p>
              <p id="modalRegNo" class="text-white font-semibold">-</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-calendar text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Date de Création</p>
              <p id="modalDate" class="text-white font-semibold">-</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-user text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Fondateur</p>
              <p id="modalFounder" class="text-white font-semibold">-</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-map-marker-alt text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Département</p>
              <p id="modalDept" class="text-white font-semibold">-</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-industry text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Type d'Entreprise</p>
              <p id="modalType" class="text-white font-semibold">-</p>
            </div>
          </div>

          <div class="flex items-start gap-4 p-4 bg-slate-800/50 rounded-xl">
            <div class="w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-phone text-slate-400"></i>
            </div>
            <div>
              <p class="text-xs text-slate-500 mb-1">Contact</p>
              <p id="modalContact" class="text-white font-semibold">-</p>
            </div>
          </div>

        </div>
      </div>

      <!-- Modal Footer -->
      <div class="p-6 border-t border-slate-800 bg-slate-900/50">
        <button onclick="closeModal()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-3 px-6 rounded-xl transition-colors">
          Fermer
        </button>
      </div>
    </div>
  </div>

  <script>
    // Mock Data
    const mockData = [
      { regNo: "CG-BZV-2024-001", name: "Congo Import Export SARL", date: "2024-03-15", founder: "Jean-Pierre Mbongo", department: "Brazzaville", type: "Commerce International", contact: "+242 06 500 1234" },
      { regNo: "CG-PNR-2023-045", name: "Pointe-Noire Logistics", date: "2023-07-22", founder: "Marie Nkounkou", department: "Pointe-Noire", type: "Transport & Logistique", contact: "+242 05 600 5678" },
      { regNo: "CG-BZV-2025-002", name: "Tech Congo Solutions", date: "2025-01-10", founder: "Patrick Ondongo", department: "Brazzaville", type: "Technologie", contact: "+242 06 700 9012" },
      { regNo: "CG-CUV-2022-018", name: "Cuvette Agro Industries", date: "2022-11-08", founder: "Sylvie Moukala", department: "Cuvette", type: "Agriculture", contact: "+242 05 800 3456" },
      { regNo: "CG-NIA-2024-007", name: "Niari Mining Corp", date: "2024-06-30", founder: "Bernard Ossoko", department: "Niari", type: "Extraction Minière", contact: "+242 06 900 7890" },
      { regNo: "CG-BZV-2023-089", name: "Brazza Construction", date: "2023-02-14", founder: "Claude Makosso", department: "Brazzaville", type: "BTP", contact: "+242 05 100 2345" },
      { regNo: "CG-PNR-2025-003", name: "Ocean Fish Congo", date: "2025-02-28", founder: "Anne-Marie Loamba", department: "Pointe-Noire", type: "Pêche", contact: "+242 06 200 6789" },
      { regNo: "CG-SAN-2021-056", name: "Sangha Forestry Ltd", date: "2021-09-05", founder: "Joseph Bongo", department: "Sangha", type: "Exploitation Forestière", contact: "+242 05 300 0123" },
      { regNo: "CG-BZV-2024-034", name: "Congo Digital Bank", date: "2024-08-19", founder: "Francine Itoua", department: "Brazzaville", type: "Finance", contact: "+242 06 400 4567" },
      { regNo: "CG-LEK-2023-012", name: "Lékoumou Palm Oil", date: "2023-04-11", founder: "Paul Ngoma", department: "Lékoumou", type: "Agro-industrie", contact: "+242 05 500 8901" },
      { regNo: "CG-PNR-2024-067", name: "Port Services International", date: "2024-12-03", founder: "Gérard Mouanda", department: "Pointe-Noire", type: "Services Portuaires", contact: "+242 06 600 2345" },
      { regNo: "CG-PLT-2022-029", name: "Plateaux Cattle Ranch", date: "2022-05-27", founder: "Emmanuel Obami", department: "Plateaux", type: "Élevage", contact: "+242 05 700 6789" },
      { regNo: "CG-BZV-2025-008", name: "Kongo Telecom", date: "2025-03-05", founder: "Sarah Mpassi", department: "Brazzaville", type: "Télécommunications", contact: "+242 06 800 0123" },
      { regNo: "CG-BOZ-2023-041", name: "Bouenza Coffee Cooperative", date: "2023-10-16", founder: "Michel Nzaba", department: "Bouenza", type: "Agriculture", contact: "+242 05 900 4567" },
      { regNo: "CG-PNR-2024-088", name: "Petro Congo Energy", date: "2024-09-22", founder: "Alain Okombi", department: "Pointe-Noire", type: "Énergie", contact: "+242 06 000 8901" }
    ];

    const departments = [
      "Tous les départements",
      "Brazzaville",
      "Pointe-Noire",
      "Bouenza",
      "Cuvette",
      "Cuvette-Ouest",
      "Kouilou",
      "Lékoumou",
      "Likouala",
      "Niari",
      "Plateaux",
      "Pool",
      "Sangha"
    ];

    let currentFilter = "Tous les départements";
    let departmentChart, yearChart;

    // Initialize Dashboard
    function init() {
      populateDepartments();
      updateAnalytics();
      renderTable(mockData);
      initCharts();
      setupSearch();
    }

    // Populate Department List
    function populateDepartments() {
      const list = document.getElementById("departmentList");
      list.innerHTML = departments.map((dept, index) => `
        <li>
          <button 
            onclick="filterByDepartment('${dept}')"
            class="department-item w-full text-left px-4 py-2.5 rounded-lg text-sm transition-all border-l-2 border-transparent ${index === 0 ? 'active text-white' : 'text-slate-400 hover:text-white'}"
            data-dept="${dept}"
          >
            <i class="fas ${index === 0 ? 'fa-globe' : 'fa-map-pin'} mr-2 text-xs opacity-50"></i>
            ${dept}
          </button>
        </li>
      `).join("");
    }

    // Update Analytics Cards
    function updateAnalytics() {
      const total = mockData.length;
      const thisYear = mockData.filter(c => c.date.startsWith("2025")).length;
      
      // Count by department
      const deptCounts = {};
      mockData.forEach(c => {
        deptCounts[c.department] = (deptCounts[c.department] || 0) + 1;
      });
      
      const mostActive = Object.entries(deptCounts).sort((a, b) => b[1] - a[1])[0];

      document.getElementById("totalCompanies").textContent = total;
      document.getElementById("companiesThisYear").textContent = thisYear;
      document.getElementById("mostActiveDept").textContent = mostActive[0];
      document.getElementById("mostActiveDeptCount").innerHTML = `<i class="fas fa-trophy"></i> <span>${mostActive[1]} entreprises</span>`;
    }

    // Render Table
    function renderTable(data) {
      const tbody = document.getElementById("companyTableBody");
      const emptyState = document.getElementById("emptyState");
      const displayCount = document.getElementById("displayCount");

      displayCount.textContent = data.length;

      if (data.length === 0) {
        tbody.innerHTML = "";
        emptyState.classList.remove("hidden");
        return;
      }

      emptyState.classList.add("hidden");
      tbody.innerHTML = data.map(company => `
        <tr class="hover:bg-slate-800/50 cursor-pointer transition-colors" onclick="openModal('${company.regNo}')">
          <td class="px-6 py-4">
            <span class="font-mono text-sm text-congo-green">${company.regNo}</span>
          </td>
          <td class="px-6 py-4">
            <span class="font-medium text-white">${company.name}</span>
          </td>
          <td class="px-6 py-4 hidden md:table-cell">
            <span class="text-slate-400">${formatDate(company.date)}</span>
          </td>
          <td class="px-6 py-4 hidden lg:table-cell">
            <span class="text-slate-400">${company.founder}</span>
          </td>
          <td class="px-6 py-4">
            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-slate-800 text-slate-300">
              ${company.department}
            </span>
          </td>
        </tr>
      `).join("");
    }

    // Format Date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString("fr-FR", { day: "2-digit", month: "short", year: "numeric" });
    }

    // Initialize Charts
    function initCharts() {
      // Department Chart Data
      const deptCounts = {};
      departments.slice(1).forEach(d => deptCounts[d] = 0);
      mockData.forEach(c => {
        if (deptCounts[c.department] !== undefined) {
          deptCounts[c.department]++;
        }
      });

      const deptLabels = Object.keys(deptCounts).filter(d => deptCounts[d] > 0);
      const deptData = deptLabels.map(d => deptCounts[d]);

      // Year Chart Data
      const yearCounts = {};
      mockData.forEach(c => {
        const year = c.date.split("-")[0];
        yearCounts[year] = (yearCounts[year] || 0) + 1;
      });

      const yearLabels = Object.keys(yearCounts).sort();
      const yearData = yearLabels.map(y => yearCounts[y]);

      // Chart.js defaults
      Chart.defaults.color = "#94a3b8";
      Chart.defaults.borderColor = "#334155";

      // Bar Chart
      const barCtx = document.getElementById("departmentChart").getContext("2d");
      departmentChart = new Chart(barCtx, {
        type: "bar",
        data: {
          labels: deptLabels,
          datasets: [{
            label: "Entreprises",
            data: deptData,
            backgroundColor: "rgba(34, 139, 34, 0.8)",
            borderColor: "rgba(34, 139, 34, 1)",
            borderWidth: 1,
            borderRadius: 6,
            barThickness: 40
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 },
              grid: { color: "#1e293b" }
            },
            x: {
              grid: { display: false },
              ticks: { maxRotation: 45, minRotation: 45 }
            }
          }
        }
      });

      // Pie Chart
      const pieCtx = document.getElementById("yearChart").getContext("2d");
      const pieColors = ["#228B22", "#3b82f6", "#f59e0b", "#ef4444", "#8b5cf6"];
      yearChart = new Chart(pieCtx, {
        type: "doughnut",
        data: {
          labels: yearLabels,
          datasets: [{
            data: yearData,
            backgroundColor: pieColors.slice(0, yearLabels.length),
            borderColor: "#0f172a",
            borderWidth: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "right",
              labels: { padding: 20, usePointStyle: true, pointStyle: "circle" }
            }
          },
          cutout: "60%"
        }
      });
    }

    // Filter by Department
    function filterByDepartment(dept) {
      currentFilter = dept;
      
      // Update active state
      document.querySelectorAll(".department-item").forEach(btn => {
        if (btn.dataset.dept === dept) {
          btn.classList.add("active", "text-white");
          btn.classList.remove("text-slate-400");
        } else {
          btn.classList.remove("active", "text-white");
          btn.classList.add("text-slate-400");
        }
      });

      applyFilters();
      
      // Close sidebar on mobile
      if (window.innerWidth < 1024) {
        toggleSidebar();
      }
    }

    // Setup Search
    function setupSearch() {
      const searchInput = document.getElementById("searchInput");
      searchInput.addEventListener("input", applyFilters);
    }

    // Apply Filters
    function applyFilters() {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      
      let filtered = mockData;
      
      // Apply department filter
      if (currentFilter !== "Tous les départements") {
        filtered = filtered.filter(c => c.department === currentFilter);
      }
      
      // Apply search filter
      if (searchTerm) {
        filtered = filtered.filter(c => 
          c.name.toLowerCase().includes(searchTerm) || 
          c.regNo.toLowerCase().includes(searchTerm)
        );
      }

      renderTable(filtered);
    }

    // Open Modal
    function openModal(regNo) {
      const company = mockData.find(c => c.regNo === regNo);
      if (!company) return;

      document.getElementById("modalCompanyName").textContent = company.name;
      document.getElementById("modalRegNo").textContent = company.regNo;
      document.getElementById("modalDate").textContent = formatDate(company.date);
      document.getElementById("modalFounder").textContent = company.founder;
      document.getElementById("modalDept").textContent = company.department;
      document.getElementById("modalType").textContent = company.type;
      document.getElementById("modalContact").textContent = company.contact;

      document.getElementById("modal").classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }

    // Close Modal
    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
      document.body.style.overflow = "";
    }

    // Toggle Sidebar (Mobile)
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("mobileOverlay");
      
      sidebar.classList.toggle("-translate-x-full");
      overlay.classList.toggle("hidden");
    }

    // Close modal on Escape
    document.addEventListener("keydown", e => {
      if (e.key === "Escape") closeModal();
    });

    // Initialize
    init();
  </script>
</body>
</html>
